"use strict";

const Reader = require("../lib/reader").Reader;

const bufferPrefix = Buffer.alloc(4, 0x00);

test('ascii: direct call to readAsciiString()', () => {
	let data = Buffer.from([
		0x48, 0x65, 0x6C, 0x6C, 0x6F, 0x2C, 0x20,
		0x77, 0x6F, 0x72, 0x6C, 0x64, 0xA1,
		0x3C, 0x4C, 0x6F, 0x61, 0x64, 0x69, 0x6E, 0x67,
		0x52, 0x65, 0x61, 0x64, 0x79,
		0x52, 0x75, 0x6E, 0xBE
	]);
	let r = new Reader(Buffer.concat([bufferPrefix, data]));

	expect(r.readAsciiString()).toEqual("Hello, world!");
	expect(r.readAsciiString()).toEqual("<LoadingReadyRun>");
});

test('ascii: indirect call through readString()', () => {
	let data = Buffer.from([
		0x5B, 0x57, 0x65, 0x6C, 0x63, 0x6F, 0x6D, 0x65,
		0x20, 0x74, 0x6F, 0x20, 0x47, 0x6C, 0x6F, 0x6F,
		0x6D, 0x68, 0x61, 0x76, 0x65, 0x6E, 0x21, 0xDD
	]);
	let r = new Reader(data, 0);

	expect(r.readString()).toEqual("[Welcome to Gloomhaven!]");
});
